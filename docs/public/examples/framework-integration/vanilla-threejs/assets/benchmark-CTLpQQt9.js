import{l as F,S as E,P as G,W as L,A as k,D as O,e as f,d as R,M as v,B as _,f as T,n as N,o as V,k as W,I as H,G as D}from"./createProbe-AfBl9El3.js";function q(e,t,n,a={}){const o=a.frames??120,l=a.warmupFrames??30;y(e,t,n,l);const r=b(e,t,n,o),i=F({appName:a.appName??document.title??"3Lens App",...a.probeConfig});i.observeRenderer(e),i.observeScene(t),y(e,t,n,l);const h=b(e,t,n,o);return i.dispose(),{baselineAvgMs:r,instrumentedAvgMs:h,overheadPct:r>0?(h-r)/r*100:0,frames:o}}function y(e,t,n,a){for(let o=0;o<a;o++)e.render(t,n)}function b(e,t,n,a){const o=[];for(let r=0;r<a;r++){const i=performance.now();e.render(t,n),o.push(performance.now()-i)}return o.reduce((r,i)=>r+i,0)/Math.max(1,o.length)}const d={frames:300,warmupFrames:60,targetOverhead:5},w=document.getElementById("status-card"),I=document.getElementById("results"),K=w.querySelector(".status-text"),j=w.querySelector(".spinner"),x=document.getElementById("result-badge"),B=document.getElementById("overhead-value"),z=document.getElementById("baseline-value"),U=document.getElementById("instrumented-value"),J=document.getElementById("frames-value"),Q=document.getElementById("warmup-value"),X=document.getElementById("details"),M=document.getElementById("rerun-btn");function Y(){const e=document.getElementById("canvas-container"),t=new E;t.name="BenchmarkScene";const n=new G(60,window.innerWidth/window.innerHeight,.1,1e3);n.position.set(15,15,15),n.lookAt(0,0,0);const a=new L({antialias:!0});a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(Math.min(window.devicePixelRatio,2)),a.setClearColor(988185),e.appendChild(a.domElement);const o=new k(16777215,.4);t.add(o);const l=new O(16777215,1);l.position.set(10,20,10),t.add(l);const r=new f(new R(50,50),new v({color:1711918,roughness:.8}));r.rotation.x=-Math.PI/2,r.position.y=-2,t.add(r);const i=[new _(1,1,1),new T(.5,24,24),new N(.5,.2,16,32),new V(.5,1,16),new W(.3,.3,1,16)],h=[2282478,3462041,16498468,16478597,10980346];for(let s=0;s<100;s++){const u=i[s%i.length],m=new v({color:h[s%h.length],roughness:.3,metalness:.6}),c=new f(u,m),A=Math.floor(s/10),C=s%10;c.position.set((C-4.5)*2,Math.sin(s*.3)*.5,(A-4.5)*2),c.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),c.name=`Object_${s}`,t.add(c)}const $=new H(.3,1),P=new v({color:6333946});for(let s=0;s<5;s++){const u=new D;u.name=`Group_${s}`,u.position.set(Math.cos(s*1.2)*8,0,Math.sin(s*1.2)*8);for(let m=0;m<5;m++){const c=new f($,P);c.name=`Child_${s}_${m}`,c.position.set(Math.cos(m*1.2),0,Math.sin(m*1.2)),u.add(c)}t.add(u)}return{scene:t,camera:n,renderer:a}}function g(e,t=!0){K.textContent=e,j.style.display=t?"block":"none"}function Z(e){const t=e.overheadPct<d.targetOverhead;x.textContent=t?"✓ PASS":"✗ FAIL",x.className=`badge ${t?"pass":"fail"}`,B.textContent=`${e.overheadPct>=0?"+":""}${e.overheadPct.toFixed(2)}%`,B.className=`overhead-value ${t?"pass":"fail"}`,z.textContent=e.baselineAvgMs.toFixed(3),U.textContent=e.instrumentedAvgMs.toFixed(3),J.textContent=e.frames.toString(),Q.textContent=d.warmupFrames.toString();const n=e.instrumentedAvgMs-e.baselineAvgMs,a=new Date().toISOString();X.textContent=`Benchmark completed at ${a}

Test Configuration:
  - Sample frames: ${d.frames}
  - Warmup frames: ${d.warmupFrames}
  - Target overhead: < ${d.targetOverhead}%

Results:
  - Baseline render time: ${e.baselineAvgMs.toFixed(4)} ms/frame
  - Instrumented render time: ${e.instrumentedAvgMs.toFixed(4)} ms/frame
  - Absolute difference: ${n>=0?"+":""}${n.toFixed(4)} ms/frame
  - Relative overhead: ${e.overheadPct>=0?"+":""}${e.overheadPct.toFixed(2)}%

Verdict: ${t?"PASS ✓ - Overhead is within acceptable limits":"FAIL ✗ - Overhead exceeds target threshold"}`,w.style.display="none",I.classList.add("show"),console.log(`
========================================`),console.log("  3Lens Performance Benchmark Results"),console.log(`========================================
`),console.log(`  Baseline:      ${e.baselineAvgMs.toFixed(4)} ms/frame`),console.log(`  Instrumented:  ${e.instrumentedAvgMs.toFixed(4)} ms/frame`),console.log(`  Overhead:      ${e.overheadPct.toFixed(2)}%`),console.log(`  Target:        < ${d.targetOverhead}%`),console.log(`  Status:        ${t?"✓ PASS":"✗ FAIL"}`),console.log(`
========================================
`),window.__BENCHMARK_RESULT__={...e,passed:t,target:d.targetOverhead}}async function S(){w.style.display="flex",I.classList.remove("show"),M.disabled=!0,g("Setting up benchmark scene..."),await p(100);const{scene:e,camera:t,renderer:n}=Y();g("Warming up renderer..."),await p(100);for(let o=0;o<30;o++)n.render(e,t);g(`Running benchmark (${d.frames} frames × 2 runs)...`),await p(100);const a=q(n,e,t,{frames:d.frames,warmupFrames:d.warmupFrames,appName:"Benchmark Test"});g("Processing results..."),await p(100),Z(a),n.dispose(),M.disabled=!1}function p(e){return new Promise(t=>setTimeout(t,e))}M.addEventListener("click",()=>{const e=document.getElementById("canvas-container");e.innerHTML="",S()});S();
